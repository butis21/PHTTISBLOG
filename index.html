<script>
  document.addEventListener("DOMContentLoaded", loadPosts);

  function loadPosts() {
    // Fetch posts from the server or local storage
    // Example: const posts = fetchPostsFromServer();
    fetch("https://api.github.com/repos/butis21/PHTTISBLOG/contents/posts.txt")
      .then(response => response.json())
      .then(data => {
        const posts = atob(data.content).split('\n').filter(Boolean).map(line => {
          const [name, text, time] = line.split('/');
          return { name, text, time };
        });

        const table = document.getElementById("postsTable");
        table.innerHTML = ""; // Clear existing rows

        posts.forEach((post, index) => {
          const row = table.insertRow();
          const cell1 = row.insertCell(0);
          const cell2 = row.insertCell(1);
          const cell3 = row.insertCell(2);

          cell1.textContent = index + 1;
          cell2.textContent = post.name;
          cell3.textContent = post.text;
        });
      });
  }

  function showPopup() {
    document.getElementById("overlay").style.display = "flex";
  }

  function hidePopup() {
    document.getElementById("overlay").style.display = "none";
  }

  function savePost() {
    const name = document.getElementById("name").value;
    const postText = document.getElementById("post").value;

    if (name && postText) {
      const time = new Date().toLocaleString();
      const postLine = `${name}/${postText}/${time}\n`;

      // Save post to the server or local storage
      // Example: savePostToServer(postLine);
      fetch("https://api.github.com/repos/butis21/PHTTISBLOG/contents/posts.txt", {
        method: "PUT",
        headers: {
          "Authorization": "token <ваш_токен>",
          "Accept": "application/vnd.github.v3+json",
        },
        body: JSON.stringify({
          message: "Add new post",
          content: btoa(postLine),
          sha: data.sha, // Use the sha from the response of previous fetch
        }),
      })
        .then(response => response.json())
        .then(() => {
          hidePopup();
          loadPosts(); // Refresh the table
        })
        .catch(error => console.error("Error saving post:", error));
    } else {
      alert("Имя и текст поста не могут быть пустыми!");
    }
  }
</script>
